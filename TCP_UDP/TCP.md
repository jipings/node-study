## TCP

* telnet localhost 8341
* TCP（Transmission Control Protocol 传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议，由IETF的RFC 793定义。在简化的计算机网络OSI模型中，它完成第四层传输层所指定的功能，用户数据报协议（UDP）是同一层内  另一个重要的传输协议。在因特网协议族（Internet protocol suite）中，TCP层是位于IP层之上，应用层之下的中间层。不同主机的应用层之间经常需要可靠的、像管道一样的连接，但是IP层不提供这样的流机制，而是提供不可靠的包交换。
应用层向TCP层发送用于网间传输的、用8位字节表示的数据流，然后TCP把数据流分区成适当长度的报文段（通常受该计算机连接的网络的数据链路层的最大传输单元（  MTU）的限制）。之后TCP把结果包传给IP层，由它来通过网络将包传送给接收端实体  的TCP层。TCP为了保证不发生丢包，就给每个包一个序号，同时序号也保证了传送到接收端实体的包的按序接收。然后接收端实体对已成功收到的包发回一个相应的确认（ACK）；如果发送端实体在合理的往返时延（RTT）内未收到确认，那么对应的数据包就被假设为已丢失将会被进行重传。TCP用一个校验和函数来检验数据是否有错误；在发送和接收时都要计算校验和。

### Nagle 算法
如果每次只发送一个字节的内容而不优化，网络中将充满只有极少数有效数据的数据包，将十分浪费网络资源。Nagle算法针对这种情况，要求缓冲区的数据达到一定数量或者一定时间后才将其发出，所以小数据包将会被Nagle算法合并，以此来优化网络。这种优化虽然使带宽被有效的利用，但是数据有可能被延迟发送。
在Node中，由于TCP默认启用Nagle算法，可以调用 `socket.setNoDelay(true)`去掉Nagle算法，使得write() 可以立即发送数据到网络中。
另一个需要注意的是，尽管在网络的一端调用write()会触发另一端的data事件，但是并不
意味着每次write()都会触发一次data事件，在关闭掉Nagle算法后，另一端可能会将接收到的多
个小数据包合并，然后只触发一次data事件。